(window["webpackJsonpbear-frog-chess"]=window["webpackJsonpbear-frog-chess"]||[]).push([[0],{28:function(e,t,a){},45:function(e,t,a){e.exports=a(92)},54:function(e,t,a){},57:function(e,t){},85:function(e,t,a){},90:function(e,t,a){},91:function(e,t,a){},92:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(14),l=a.n(r),s=a(4);const c="GAME_CONTROL/RESET",i="GAME_CONTROL/UPDATE_SOCKET";var d=a(3);const p="\u65e0\u68cb",m="\u6709\u68cb",h=(e,t)=>{let a={};for(let n=0;n<e.length;n++){const o=e[n];for(let e=0;e<o.length;e++){if(o[e].id===t){a={x:n,y:e};break}}}return a};let y=0;const u=(e,t)=>({id:y++,player:e,type:t}),g=()=>[[u(1,m),u(1,m),u(1,m),u(1,m)],[u(1,m),u(null,p),u(null,p),u(1,m)],[u(0,m),u(null,p),u(null,p),u(0,m)],[u(0,m),u(0,m),u(0,m),u(0,m)]],E=()=>({player:{players:[{name:"\u718a\u65b9"},{name:"\u86d9\u65b9"}],order:[0,1],local:[0,1],nowPlayer:0},chessBoard:{board:g(),selected:!1,selectId:-1},gameControl:{}});const v=new class{constructor(){this.socketClient=null,this.setSocketClient=this.setSocketClient.bind(this),this.getSocketClient=this.getSocketClient.bind(this)}setSocketClient(e){this.socketClient=e}getSocketClient(){return this.socketClient}};var f=a(42),b=(a(28),a(109)),w=a(110);const O="CHESS_BOARD/SELECT",N="CHESS_BOARD/MOVE_TO",C="CHESS_BOARD/SET_BOARD",S=e=>({type:C,board:e});class P{connect(e){this.ws=new WebSocket(e),this.ws.onclose=e=>{e.isTrusted||alert("webSocket onClose!"+JSON.stringify(e))},this.ws.onerror=e=>{alert("webSocket onError!"+e)}}disconnect(){this.ws.close(1e3,"\u6b63\u5e38\u5173\u95ed")}send(e){this.ws.send(JSON.stringify(e))}setOnMessage(e){this.ws.onmessage=e}setOnOpen(e){this.ws.onopen=e}}const k=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{board:e,nowPlayer:t,isRoundEnd:a,needMessage:n}},I=(e,t)=>({type:"PLAYER/PLAY",local:e,nowPlayer:t}),x=e=>e.reduce((e,t)=>e.concat(Array.isArray(t)?x(t):t),[]);function A(e,t,a){const n=e.length,o=e[0].length,r=[0,0,-1,1],l=[1,-1,0,0],s=[];for(const c in r){const i=t+r[c],d=a+l[c];i>=0&&i<n&&d>=0&&d<o&&e[i][d].type===p&&s.push(e[i][d].id)}return s}const R=(e,t)=>{let{board:a,selectId:n,selected:o}=e;if(!o)return!1;const{x:r,y:l}=h(a,n);return-1!==A(a,r,l).indexOf(t)};function M(e,t,a,n){const o=e.map(e=>e.map(e=>Object(d.a)({},e))),r=o[t.x][t.y];o[t.x][t.y]=o[a][n],o[a][n]=r,o[t.x][t.y].typeChangeInfo={reason:"LEAVE",x:a,y:n},o[a][n].typeChangeInfo={reason:"ARRIVE",x:t.x,y:t.y};const l=o[a][n].player;return o[t.x][t.y].player=l,function(e,t,a,n){for(let o=0;o<2;o++){let r=e.length,l=e[0].length;o&&([r,l]=[l,r]);const s=o?t:a;let c=0,i=0,d=0,m=0,h=0;const y=[];for(let t=0;t<l;t++){const[a,r]=o?[s,t]:[t,s],l=e[a][r];l.type!=p?(c++,i=Math.max(c,i),l.player===n?(d++,m=Math.max(d,m),h++):(y.push(l),d=0)):(c=0,d=0)}if(3==i&&2==m&&2==h&&1==y.length)for(let e=0;e<y.length;e++)y[e].type=p,y[e].typeChangeInfo={reason:"DIE"}}}(o,a,n,l),o}function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{players:[{name:"A"},{name:"B"}],order:[0,1]},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,1];const n=x(e),o=Object(d.a)({},a);for(const i in o)o[i]=0;for(const i in n)n[i].type===m&&o[n[i].player]++;const{players:r,order:l}=t;let s=!1,c=[];for(const i in o)o[i]<=1?s=!0:r[parseInt(i)]&&c.push(parseInt(i));if(!s){c=[];const t=Object(d.a)({},l);for(const e in t)t[e]={};for(let n=0;n<e.length;n++)for(let a=0;a<e[n].length;a++)if(e[n][a].type===m){const o=A(e,n,a),r=e[n][a].player;o.forEach(e=>{t[r][e]=!0})}const a={};for(const e in t)Object.keys(t[e])<=0&&(s=!0,r[parseInt(e)]&&(a[e]=!0));if(s)for(const e in t)console.log(e,t[e],a[e]),r[parseInt(e)]&&!a[e]&&c.push(parseInt(e));console.log("playerCanMoveCount",e,t,a)}return{gameOver:s,winners:c}}const B=e=>{const{iconClassName:t,children:a}=e;return o.a.createElement("div",{className:"".concat(t)},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",viewBox:"0 0 512 512"},o.a.createElement("text",{x:"50%",y:"50%",dominantBaseline:"central",textAnchor:"middle",style:{fontSize:"256px"}},a)))};class T extends o.a.Component{constructor(e,t){super(e,t),this.state={}}componentWillReceiveProps(e){}render(){const{player:e,type:t,beSelected:a,canBeMoveTo:n,onSelect:r,onMoveTo:l,canBeSelect:s,typeChangeInfo:c}=this.props,{playerNames:i=["\ud83d\udc3b","\ud83d\udc38"]}=this.props;let d="chess-item ".concat(1==e?"enemy":""," ");d+=t===p?"LEAVE"===c?"leave ":"DIE"===c?"die ":"normal-none  ":"ARRIVE"===c?"arrive ":"normal-display ";let m=i[e]||"\ud83d\udc36";return o.a.createElement("div",{className:"chess-block ".concat(a?"selected":""," ").concat(n?"can-be-move-to":""," ").concat(s&&!a?"can-be-select":""," "),onClick:()=>{n?l():t!=p&&s&&r()}},o.a.createElement(B,{iconClassName:d},m))}}var D=Object(s.b)((e,t)=>{let{chessId:a,player:n,type:o}=t;return{beSelected:e.chessBoard.selected&&e.chessBoard.selectId==a,canBeMoveTo:R(e.chessBoard,a),canBeSelect:e.player.nowPlayer===n&&-1!=e.player.local.indexOf(n)&&o===m}})(T);const L={getTheMove:function(e,t){const a=[];for(let r=0;r<e.length;r++)for(let n=0;n<e[r].length;n++)if(e[r][n].type===m&&e[r][n].player===t){A(e,r,n).forEach(t=>{a.push({now:e[r][n].id,next:t})})}var n,o;return a[(n=0,o=a.length-1,n=Math.ceil(n),o=Math.floor(o),Math.floor(Math.random()*(o-n+1))+n)]},getNextBoard:(e,t)=>{console.log("AI getNextBoard board?!",e,t);const a=L.getTheMove(e,t);let n=e;if(a){const t=h(e,a.now),o=h(e,a.next);console.log("getNextBoard theMove",a,t,o),n=M(e,t,o.x,o.y)}return n}};var _=L;class J{constructor(){this.funcs={onMessage:()=>{},onOpen:()=>{}},this.store={timeout:0}}connect(e){}disconnect(){clearTimeout(this.store.timeout)}send(e){console.log("AIClient send",e),clearTimeout(this.store.timeout),this.store.timeout=setTimeout(()=>{const{nowPlayer:t,isRoundEnd:a}=e;if(j(e.board).gameOver)return;const n=null===t?1:t,o=n?0:1,r={board:_.getNextBoard(e.board,n),isRoundEnd:!1,needMessage:!1,nowPlayer:o};this.funcs.onMessage({data:JSON.stringify(r)})},1e3)}setOnMessage(e){this.funcs.onMessage=e}setOnOpen(e){this.funcs.onOpen=e}}class U extends n.Component{constructor(e){super(e),console.log("PlayControl\u3000constructor",e);const{roomId:t,vsAI:a,player:n}=e;if(this.props.setBoard(),e.roomId||a){this.props.setLocalPlayer([parseInt(e.player)]);const t="ws://rank.daifish.top:8089/bearFrogChess/"+e.roomId,n=new(a?J:P);n.connect(t),n.setOnOpen(()=>{n.send(k(null,null,null,!0))}),n.setOnMessage(t=>{console.log(t,t.data,JSON.parse(t.data));const a=JSON.parse(t.data);if(a.needMessage){const{board:e,nowPlayer:t,gameOver:a}=this.props;a||n.send(k(e,t,!1))}else e.onReceiveBoard(a)}),v.setSocketClient(n)}else this.props.setLocalPlayer([0,1]),v.getSocketClient()&&(v.getSocketClient().disconnect(),v.setSocketClient(null))}componentWillReceiveProps(e){const{gameOver:t}=this.props,{gameOver:a,winners:n}=e;console.log("judge gameOver! ",this.props,a,t),a&&!t&&setTimeout(()=>{alert("\u6e38\u620f\u7ed3\u675f\uff01\u80dc\u8005\u662f".concat(this.getPlayerNames()[n])),e.resetAll()},1e3)}componentWillUnmount(){v.getSocketClient()&&(v.getSocketClient().disconnect(),v.setSocketClient(null))}getPlayerNames(){const{params:e}=this.props;let t=["\ud83d\udc3b","\ud83d\udc38"];return e.playerNames&&(t=JSON.parse(e.playerNames)),t}render(){const{ChessBoard:e,player:t,gameOver:a,roomId:n,params:r}=this.props;return o.a.createElement("div",{className:"full-window"},o.a.createElement("div",{className:"inner-window"},n?o.a.createElement("div",null,"\u623f\u95f4",n):"",o.a.createElement("div",null,o.a.createElement(e,{playerNames:this.getPlayerNames()})),o.a.createElement("div",null,t),o.a.createElement("div",null,"\u89c4\u5219\uff1a\u672c\u56de\u5408\u79fb\u52a8\u7684\u5df1\u65b9\u68cb\u5b50\u548c\u5176\u79fb\u52a8\u540e\u76f8\u90bb\u7684\u68cb\u5b50\uff0c\u4e24\u4e2a\u68cb\u5b50\u7ec4\u6210\u70ae\u53f0\uff0c\u6740\u6b7b\u5904\u5728\u8be5\u70ae\u53f0\u8fde\u7ebf\u4e0a\u76f8\u90bb\u7684\u654c\u65b9\u68cb\u5b50\u3002\u5982\u679c\u8fd9\u6761\u76f4\u7ebf\u4e0a\u67094\u4e2a\u68cb\u5b50\u5219\u6740\u4e0d\u6389\u3002\u5f53\u6709\u73a9\u5bb6\u53ea\u52691\u9897\u68cb\u5b50\u6216\u8005\u65e0\u6cd5\u884c\u52a8\u65f6\u8f93\u6389\u3002")))}}var Y=Object(s.b)(e=>{const t=e.chessBoard.board,{gameOver:a,winners:n}=j(t,e.player,e.player.order);return{gameOver:a,winners:a?n:[],board:t,nowPlayer:e.player.nowPlayer}},e=>({setLocalPlayer:t=>{e(I(t))},setNowPlayer:t=>{e(I(null,t))},setBoard:t=>{e(S(t))},resetAll:()=>{e(S())},onReceiveBoard:t=>{const{board:a,nowPlayer:n,isRoundEnd:o}=t;console.log("will dispatch, board=",a,n,o),e(S(a)),(n||0===n)&&e(I(null,n)),o&&e({type:"PLAYER/ROUND_END"})}}))(U),V=(a(54),a(107)),W=a(15),F=a.n(W);const H=[{title:"\u5355\u6311AI",url:"/local-ai/1/0"},{title:"\u672c\u5730\u53cc\u4eba",url:"/local"},{title:"\u7f51\u7edc\u5bf9\u6218",urlFunc:()=>{const e=Math.floor(1e6*Math.random()+1);return"/room/".concat(e)}}];var G=e=>{const t=e.location.search,a=F.a.parse(t,{ignoreQueryPrefix:!0});let n="\u718a\u86d9\u68cb";if(a.playerNames){n="";const e=JSON.parse(a.playerNames);console.log("gameNameDisplay",F.a.stringify({playerNames:a.playerNames})),e.forEach(e=>n+=e),n+="\u68cb"}return o.a.createElement("div",{className:"menu-page"},o.a.createElement("div",{className:"title-field"},o.a.createElement("div",{className:"page-title"},n)),o.a.createElement("div",{className:"right-field"},o.a.createElement("div",{className:"page-select-list"},H.map(a=>{const{title:n,url:r,urlFunc:l}=a;return o.a.createElement("div",{key:n},o.a.createElement(V.a,{raised:"raised",className:"mdc-button my-button",onClick:()=>{l?e.history.push("".concat(l()).concat(t)):e.history.push("".concat(r).concat(t))}},n))}))))},K=(a(85),a(40));const Q=e=>{const{playerName:t,url:a}=e;return o.a.createElement("div",{className:"one-player-panel"},o.a.createElement("div",null,t),o.a.createElement("div",null,o.a.createElement("input",{className:"my-input",value:a,readOnly:!0}),o.a.createElement(K.CopyToClipboard,{text:a,onCopy:()=>{}},o.a.createElement("button",{className:"copy-button",onClick:()=>{}},"\u590d\u5236\u7f51\u5740"))),o.a.createElement(V.a,{raised:"raised",className:"enter-button",onClick:()=>{e.onJump&&e.onJump()}},"\u8fdb\u5165".concat(t,"\u5ea7\u4f4d")))};var Z=e=>{const{history:t,roomId:a,params:n={}}=e,{host:r,href:l,pathname:s}=window.location;console.log("location!",e.location,window.location);const c=l.split("#")[0],i=e.location.search;return o.a.createElement("div",{className:"menu-page"},o.a.createElement("div",{className:"title-field"},o.a.createElement("div",{className:"page-info"},"\u7f51\u7edc1V1\u5bf9\u6218\uff1a\u628a\u4e00\u4e2a\u5ea7\u4f4d\u7684\u7f51\u5740\u53d1\u7ed9\u670b\u53cb\uff0c\u81ea\u5df1\u8fdb\u5165\u53e6\u4e00\u4e2a\u5ea7\u4f4d\u7f51\u5740\u3002"),o.a.createElement("div",null,o.a.createElement(V.a,{outlined:"outlined",className:"back-button",onClick:()=>{e.history.push("/".concat(i))}},"\u8fd4\u56de\u4e3b\u83dc\u5355"))),o.a.createElement("div",{className:"right-field"},o.a.createElement("div",{className:"player-copy-field"},o.a.createElement(Q,{playerName:"\u73a9\u5bb61",url:"".concat(c,"#/online/").concat(a,"/",0).concat(i),onJump:()=>{e.history.push("/online/".concat(a,"/",0).concat(i))}}),o.a.createElement(Q,{playerName:"\u73a9\u5bb62",url:"".concat(c,"#/online/").concat(a,"/",1).concat(i),onJump:()=>{e.history.push("/online/".concat(a,"/",1).concat(i))}}))))};const z=["match","location"];class q extends n.Component{render(){const{chessBoard:e,player:t,gameOver:a}=this.props,n=e=>{let{match:t,location:a}=e,n=Object(f.a)(e,z);console.log("playControl",t,n,this.props);const r=F.a.parse(a.search,{ignoreQueryPrefix:!0});return o.a.createElement(Y,Object.assign({},this.props,{roomId:t.params.roomId,player:t.params.playerId,vsAI:t.params.hasAI,params:r}))};return o.a.createElement("div",{className:"full-window"},o.a.createElement("div",{className:"inner-window"},o.a.createElement(b.a,null,o.a.createElement(w.a,{path:"/local",component:n}),o.a.createElement(w.a,{path:"/local-ai/:hasAI/:playerId",component:n}),o.a.createElement(w.a,{path:"/online/:roomId/:playerId",component:n}),o.a.createElement(w.a,{exact:!0,path:"/",component:G}),o.a.createElement(w.a,{path:"/room/:roomId",component:e=>{const{match:t}=e;return o.a.createElement(Z,Object.assign({},e,{roomId:t.params.roomId}))}}))))}}var X=Object(s.b)(e=>({}))(q);a(90);var $=Object(s.b)(e=>({board:e.chessBoard.board}),e=>({onSelect:t=>{e((e=>({type:O,id:e}))(t))},onMoveTo:t=>{e((e=>({type:N,id:e}))(t)),e({type:"PLAYER/ROUND_END"})}}))(e=>{let{board:t,onSelect:a,onMoveTo:n,playerNames:r}=e,l=0;return o.a.createElement("div",{className:"chess-board"},t.map(e=>o.a.createElement("div",{className:"row",key:l++},e.map((e,t)=>o.a.createElement(D,{key:t,chessId:e.id,player:e.player,playerNames:r,type:e.type,onSelect:()=>a(e.id),onMoveTo:()=>n(e.id)})))))});Object(s.b)((e,t)=>({active:e.game.nowPlayer===t.player&&0===e.game.players[t.player].cardPlayed.length}))(e=>{let{type:t,active:a,isShow:n,onRemove:r}=e,l="";switch(t){case 0:l="\u77f3\u5934";break;case 1:l="\u526a\u5200";break;case 2:l="\u5e03"}return o.a.createElement("div",{className:"card",onClick:a?r:null,style:{backgroundColor:a?"yellow":"white"}},a||n?l:"")});class ee extends n.Component{constructor(e,t){super(e,t),this.render=this.render.bind(this),this.state={}}componentDidUpdate(e){const t=this.props.isNowPlayer,a=this.props.onRemoveCard,n=this.props.isComputer,o=this.props.player,r=this.props.cards,l=this.props.nowPlayer,s=this.props.life;if(console.log("AI",t,n,o,l),t&&n&&s>0){const e=r.length;a(r[Math.floor(Math.random()*e)].id,o)}}render(){const e=this.props.player,t=this.props.life,a=(this.props.onRemoveCard,this.props.noCard),n=this.props.isComputer;if(a&&!n){let e="\u51fa\u5b8c\u4e86\uff01\u4f60\u8fd8\u5269".concat(t,"\u661f\u661f\uff0c");e+=3===t?"\u80fd\u591f\u5168\u8eab\u800c\u9000\uff0c\u65e0\u654c\u3002":t<3?"\u4e0d\u8db33\u9897\uff0c\u5b8c\u86cb\u4e86\u3002":"\u8d5a\u5230\u3002",alert(e),window.location.href=t>=3?"http://www.daifish.top/hebi.html":"http://www.daifish.top/mario.html"}return o.a.createElement("div",{className:"playerZone"},t<=0?o.a.createElement("div",{className:"dead"},"\u6b7b\u4e86\u3002"):o.a.createElement("div",null,e,o.a.createElement("div",{className:"lifeZone"},Array.from(Array(t),()=>"\u2605").map(e=>o.a.createElement("span",null,e)))))}}Object(s.b)((e,t)=>({cards:e.player.players[t.player].cards,life:e.player.players[t.player].life,noCard:!1,isComputer:e.player.players[t.player].isComputer,isNowPlayer:e.player.nowPlayer===t.player,nowPlayer:e.player.nowPlayer}),e=>({onRemoveCard:(t,a)=>{e(I(t,a))}}))(ee);var te=Object(s.b)(e=>({nowPlayerName:e.player.players[e.player.nowPlayer].name}),e=>({roundEnd:()=>{e({type:"PLAYER/ROUND_END"})}}))(e=>{let{nowPlayerName:t,roundEnd:a}=e;return o.a.createElement("div",{className:"",onClick:a},"\u73b0\u5728\u8f6e\u5230",t,"\u884c\u52a8")}),ae=(a(91),()=>o.a.createElement("div",{className:""},o.a.createElement(te,null)));var ne=function(){const e=$,t=o.a.createElement(ae,null);return o.a.createElement(X,{ChessBoard:e,player:t})},oe=a(108),re=a(11);const le=window,se=Object(re.c)({player:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PLAYER/ROUND_END":return Object(d.a)(Object(d.a)({},e),{},{nowPlayer:e.order[(e.order.indexOf(e.nowPlayer)+1)%e.order.length]});case"PLAYER/PLAY":{const a=Object(d.a)(Object(d.a)({},e),{},{nowPlayer:t.nowPlayer?t.nowPlayer:0});return t.local&&(a.local=t.local),a}default:return e}},chessBoard:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return console.log(t),Object(d.a)(Object(d.a)({},e),{},{selected:!0,selectId:t.id});case N:{const a=h(e.board,e.selectId),{x:n,y:o}=h(e.board,t.id),r=e.board;console.log(a.x,a.y,n,o,e.selectId,t.id,e.board);const l=M(r,a,n,o);return v.getSocketClient()&&v.getSocketClient().send(k(l,null,!0)),Object(d.a)(Object(d.a)({},e),{},{board:l,selected:!1})}case O:return e.filter(e=>e.id!==t.id);case C:{console.log("SET_BOARD!REDUCER, got action:",t);let a=t.board;return a||(a=g(),v.getSocketClient()&&v.getSocketClient().send(k(a,null,!0))),Object(d.a)(Object(d.a)({},e),{},{board:a})}default:return e}},gameControl:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case c:return console.log("RESET!",E()),E();case i:{console.log("UPDATE_SOCKET!",t.socketClient);const{socketClient:a}=t;return Object(d.a)(Object(d.a)({},e),{},{socketClient:a})}default:return e}}});const ce=Object(re.d)(Object(re.a)(),le&&le.devToolsExtension?le.devToolsExtension():e=>e);var ie=Object(re.e)(se,E(),ce);l.a.render(o.a.createElement(s.a,{store:ie},o.a.createElement(oe.a,null,o.a.createElement(ne,null))),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.f1bedc57.chunk.js.map